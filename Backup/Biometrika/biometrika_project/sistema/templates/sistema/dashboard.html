{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-eval';">
    <title>Biometrika S.A</title>
    <link rel="stylesheet" href="{% static 'css/style_dashboard.css' %}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!--Barra de opciones-->
    <nav class="barra_opciones"> 
        <h2>
            <div class="fingerprint-scanner" id="fingerprintScanner">
                <i class="fas fa-fingerprint fa-1x text-primary">   Biometrika</i>
            </div> 
        </h2>
        <ul>
            <li><a href="{% url 'sistema:dashboard' %}"><i class="fa-solid fa-gauge"></i>Dashboard</a></li>
            <li><a href="{% url 'sistema:sedes' %}"><i class="fa-solid fa-building"></i>Sedes y Areas</a></li>
            <li><a href="{% url 'sistema:personal' %}"><i class="fa-solid fa-users"></i>Gestion de Personal</a></li>
            <li><a href="{% url 'sistema:dispositivos' %}"><i class="fas fa-microchip"></i>Dispositivos</a></li>
            <li><a href="{% url 'sistema:soporte' %}?from=dashboard"><i class="fa-solid fa-headset"></i>Soporte</a></li>
            <li><a href="{% url 'sistema:reportes' %}"><i class="fa-solid fa-file-lines"></i>Reportes</a></li>
            <li><a href="{% url 'sistema:alertas' %}"><i class="fa-solid fa-bell"></i>Alertas</a></li>
        </ul>
    </nav>
    
    <!--Contenido principal de la pagina-->
    <main class="contenido">
        <header>
            <h1><i class="fa-solid fa-gauge"></i> <b>Dashboard</b></h1>
        </header>
        
        <!--paneles dashboard-->
        <section class="panels">
            <div class="panel">
                <h3><i class="fa-solid fa-user"></i> <b>Empleados</b></h3>
                <p>{{ empleados_total }}</p>
            </div>
            <div class="panel">
                <h3><i class="fa-solid fa-user-check"></i> <b>Presentes</b></h3>
                <p>{{ empleados_presentes }}</p>
            </div>
            <div class="panel">
                <h3><i class="fa-solid fa-user-times"></i> <b>Ausentes</b></h3>
                <p>{{ empleados_ausentes }}</p>
            </div>
            <div class="panel">
                <h3><i class="fa-solid fa-clock"></i> <b>Tardanzas</b></h3>
                <p>{{ tardanzas }}</p>
            </div>
            <div class="panel">
                <h3><i class="fa-solid fa-building"></i> <b>Sedes</b></h3>
                <p>{{ sedes }}</p>
            </div>
            <div class="panel">
                <h3><i class="fa-solid fa-microchip"></i> <b>Dispositivos</b></h3>
                <p>{{ dispositivos }}</p>
            </div>
            <div class="panel">
                <h3><i class="fa-solid fa-square-dashed-circle-plus"></i> <b>Modificar</b></h3>
                <p><b>+</b></p>
            </div>   
        </section>
        
        <!-- Sección de Gráficos Estadísticos -->
        <section class="graficos-dashboard">
            <!-- Gráfico de Asistencia -->
            <div class="grafico-card">
                <h3><i class="fa-solid fa-chart-pie"></i> Asistencia Hoy</h3>
                <div class="grafico-container">
                    <canvas id="asistenciaChart"></canvas>
                </div>
                <div class="estadisticas-resumen">
                    <div class="estadistica-item">
                        <div class="estadistica-valor">{{ empleados_ausentes }} ({{ empleados_ausentes|floatformat:2 }}%)</div>
                        <div class="estadistica-label">Ausencia</div>
                    </div>
                    <div class="estadistica-item">
                        <div class="estadistica-valor">{{ empleados_presentes }} ({{ empleados_presentes|floatformat:2 }}%)</div>
                        <div class="estadistica-label">Asistencia</div>
                    </div>
                </div>
            </div>
            
            <!-- Gráfico de Estado de Dispositivos -->
            <div class="grafico-card">
                <h3><i class="fa-solid fa-microchip"></i> Estado de Dispositivos</h3>
                <div class="grafico-container">
                    <canvas id="dispositivosChart"></canvas>
                </div>
                <div class="estadisticas-resumen">
                    <div class="estadistica-item">
                        <div class="estadistica-valor">{{ dispositivos_activos }} ({{ dispositivos_activos|floatformat:2 }}%)</div>
                        <div class="estadistica-label">Online</div>
                    </div>
                    <div class="estadistica-item">
                        <div class="estadistica-valor">{{ dispositivos_inactivos }} ({{ dispositivos_inactivos|floatformat:2 }}%)</div>
                        <div class="estadistica-label">Offline</div>
                    </div>
                </div>
            </div>
            
            <!-- Gráfico de Presentismo (Reemplaza Programación) -->
            <div class="grafico-card">
                <h3><i class="fa-solid fa-user-check"></i> Presentismo</h3>
                <div class="grafico-container">
                    <canvas id="presentismoChart"></canvas>
                </div>
                <div class="estadisticas-resumen">
                    <div class="estadistica-item">
                        <div class="estadistica-valor">{{ empleados_presentes }} ({{ empleados_presentes|floatformat:2 }}%)</div>
                        <div class="estadistica-label">Presentes</div>
                    </div>
                    <div class="estadistica-item">
                        <div class="estadistica-valor">{{ empleados_ausentes }} ({{ empleados_ausentes|floatformat:2 }}%)</div>
                        <div class="estadistica-label">Ausentes</div>
                    </div>
                </div>
            </div>
            
            <!-- Gráfico de Excepciones de Asistencia -->
            <div class="grafico-card">
                <h3><i class="fa-solid fa-chart-bar"></i> Excepción de Asistencia</h3>
                <div class="grafico-container">
                    <canvas id="excepcionesChart"></canvas>
                </div>
                <div class="leyenda-grafico">
                    <div class="item-leyenda">
                        <div class="color-leyenda" style="background-color: #3498db;"></div>
                        <span>Llegadas tarde</span>
                    </div>
                    <div class="item-leyenda">
                        <div class="color-leyenda" style="background-color: #e74c3c;"></div>
                        <span>Salidas temprano</span>
                    </div>
                    <div class="item-leyenda">
                        <div class="color-leyenda" style="background-color: #f39c12;"></div>
                        <span>Ausencia</span>
                    </div>
                </div>
            </div>
        </section>
        
        <!--Actividad reciente-->
        <section class="actividad">
            <div>
                <h2><i class="fa-solid fa-clock-rotate-left"></i>Actividad Reciente</h2>
                <div class="desplazamiento">
                    <table>
                        <thead>
                            <tr>
                                <th>Empleado</th>
                                <th>Área</th>
                                <th>Fecha/Hora</th>
                                <th>Estado</th>
                            </tr>
                        </thead>    
                        <tbody>
                            {% for registro in registros_recientes %}
                            <tr>
                                <td>{{ registro.empleado.nombre_completo }}</td>
                                <td>{{ registro.empleado.departamento.nombre }}</td>
                                <td>{{ registro.fecha_hora|date:"d/m/Y H:i:s" }}</td>
                                <td><span class="estado {% if registro.estado == 'exitoso' %}aprobado{% else %}denegado{% endif %}">{{ registro.estado }}</span></td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td>Roberto Juarez</td>
                                <td>Redes</td>
                                <td>10/10/2025, 09:00:05</td>
                                <td><span class="estado aprobado">aprobado</span></td>
                            </tr>
                            <tr>
                                <td>Juan rodriguez</td>
                                <td>Seguridad Informatica</td>
                                <td>10/10/2025, 08:00:05</td>
                                <td><span class="estado aprobado">aprobado</span></td>
                            </tr>
                            <tr>
                                <td>Lucia Martinez</td>
                                <td>Proyectos</td>
                                <td>05/10/2025, 12:00:05</td>
                                <td><span class="estado denegado">denegado</span></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!--Alerta de sistemas-->
        <section class="alerta-sistema">
            <h3><i class="fa-solid fa-triangle-exclamation"></i> Alertas del Sistema</h3>
            <div class="contenido-alerta">
                {% if alertas_pendientes > 0 %}
                <div class="mensaje alerta-error">
                    <i class="fa-solid fa-circle-info"></i>El Sistema no esta funcionando correctamente - {{ alertas_pendientes }} alertas
                </div>
                {% else %}
                <div class="mensaje alerta-exito">
                    <i class="fa-solid fa-circle-info"></i>El Sistema funcionando correctamente
                </div>
                {% endif %}
            </div>
        </section>
    </main>

    <!-- Menu de usuario -->
    <nav class="menu">
        <h3><a><i class="fa-solid fa-bars"></i></a></h3>
        <div>
            <ul>
                <li><a href="{% url 'sistema:notificaciones' %}"><i class="fa-solid fa-bell"></i><b>  Notificaciones</b></a></li>
                <li><a href="{% url 'sistema:perfil' %}"><i class="fa-solid fa-user"></i><b>  Perfil</b></a></li>
                <li><a href="{% url 'sistema:cambiar_contrasena' %}"><i class="fa-solid fa-key"></i><b> contraseña</b></a></li>
                <li><a href="{% url 'sistema:configuracion' %}"><i class="fa-solid fa-cog"></i><b>  Configuración</b></a></li>
                <li><a href="{% url 'sistema:cerrar_sesion' %}"><i class="fa-solid fa-right-from-bracket"></i><b>  Cerrar Sesión</b></a></li>
            </ul>
        </div>
    </nav>

    <script src="{% static 'js/dashboard.js' %}"></script>
</body>
</html>