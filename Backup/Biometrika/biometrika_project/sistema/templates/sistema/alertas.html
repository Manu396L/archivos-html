{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Alertas - Dispositivos Caídos</title>
    <link rel="stylesheet" href="{% static 'css/style_dashboard.css' %}">
    <link rel="stylesheet" href="{% static 'css/style_alertas.css' %}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <a href="{% url 'sistema:dashboard' %}" class="btn-volver" title="Volver al inicio">
        <i class="fa-solid fa-arrow-left"></i>
    </a>
    
    <!--Barra de opciones-->
    <nav class="barra_opciones"> 
        <h2>
            <div class="fingerprint-scanner" id="fingerprintScanner">
                <i class="fas fa-fingerprint fa-1x text-primary">   Biometrika</i>
            </div> 
        </h2>
        <ul>
            <li><a href="{% url 'sistema:dashboard' %}"><i class="fa-solid fa-gauge"></i>Dashboard</a></li>
            <li><a href="{% url 'sistema:sedes' %}"><i class="fa-solid fa-building"></i>Sedes y Areas</a></li>
            <li><a href="{% url 'sistema:personal' %}"><i class="fa-solid fa-users"></i>Gestion de Personal</a></li>
            <li><a href="{% url 'sistema:dispositivos' %}"><i class="fas fa-microchip"></i>Dispositivos</a></li>
            <li><a href="../admin/soporte.html?from=dashboard"><i class="fa-solid fa-headset"></i>Soporte</a></li> 
            <li><a href="{% url 'sistema:reportes' %}"><i class="fa-solid fa-file-lines"></i>Reportes</a></li>
            <li><a href="{% url 'sistema:alertas' %}" class="active"><i class="fa-solid fa-bell"></i>Alertas</a></li>
        </ul>
    </nav>
    
    <!--Contenido principal de la pagina-->
    <main class="contenido">
        <header>
            <h1><i class="fa-solid fa-triangle-exclamation"></i> <b>Alertas - Dispositivos Caídos</b></h1>
            <p class="subtitulo">Monitoreo en tiempo real del estado de los dispositivos</p>
        </header>
        
        <!-- Resumen de alertas -->
        <section class="resumen-alertas">
            <div class="resumen-item criticas">
                <div class="resumen-valor">{{ criticas }}</div>
                <div class="resumen-label">Alertas Críticas</div>
            </div>
            <div class="resumen-item advertencias">
                <div class="resumen-valor">{{ advertencias }}</div>
                <div class="resumen-label">Advertencias</div>
            </div>
            <div class="resumen-item estables">
                <div class="resumen-valor">{{ estables }}</div>
                <div class="resumen-label">Dispositivos Estables</div>
            </div>
        </section>
        
        <!-- Tabla de alertas -->
        <section class="tabla-alertas">
            <h2><i class="fa-solid fa-list"></i> Alertas Activas</h2>
            <div class="desplazamiento">
                <table>
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Prioridad</th>
                            <th>Mensaje</th>
                            <th>Dispositivo</th>
                            <th>Fecha</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>    
                    <tbody>
                        {% for alerta in alertas %}
                        <tr>
                            <td>
                                <span class="tipo-alerta tipo-{{ alerta.tipo_alerta }}">
                                    <i class="fa-solid 
                                        {% if alerta.tipo_alerta == 'dispositivo' %}fa-microchip
                                        {% elif alerta.tipo_alerta == 'seguridad' %}fa-shield-halved
                                        {% elif alerta.tipo_alerta == 'sistema' %}fa-cog
                                        {% else %}fa-bell{% endif %}">
                                    </i>
                                    {{ alerta.get_tipo_alerta_display }}
                                </span>
                            </td>
                            <td>
                                <span class="prioridad-alerta prioridad-{{ alerta.prioridad }}">
                                    {{ alerta.get_prioridad_display }}
                                </span>
                            </td>
                            <td>
                                <strong>{{ alerta.titulo }}</strong>
                                <br><small>{{ alerta.mensaje|truncatewords:10 }}</small>
                            </td>
                            <td>
                                {% if alerta.dispositivo %}
                                    {{ alerta.dispositivo.nombre }}
                                {% else %}
                                    <span class="texto-muted">Sistema</span>
                                {% endif %}
                            </td>
                            <td>{{ alerta.fecha_creacion|date:"d/m/Y H:i" }}</td>
                            <td>
                                {% if alerta.resuelta %}
                                    <span class="estado-alerta resuelta">Resuelta</span>
                                {% else %}
                                    <span class="estado-alerta activa">Activa</span>
                                {% endif %}
                            </td>
                            <td>
                                <button class="btn-resolver" onclick="resolverAlerta({{ alerta.id }})" title="Resolver">
                                    <i class="fa-solid fa-check"></i>
                                </button>
                                <button class="btn-detalles" onclick="verDetallesAlerta({{ alerta.id }})" title="Detalles">
                                    <i class="fa-solid fa-eye"></i>
                                </button>
                            </td>
                        </tr>
                        {% empty %}
                        <!-- Datos fijos de ejemplo -->
                        <tr>
                            <td>
                                <span class="tipo-alerta tipo-dispositivo">
                                    <i class="fa-solid fa-microchip"></i>
                                    Estado de Dispositivo
                                </span>
                            </td>
                            <td><span class="prioridad-alerta prioridad-critica">Crítica</span></td>
                            <td>
                                <strong>Dispositivo BIO-001 Caído</strong>
                                <br><small>El dispositivo en Recepción Principal ha dejado de responder</small>
                            </td>
                            <td>BIO-001</td>
                            <td>15/03/2024 08:45</td>
                            <td><span class="estado-alerta activa">Activa</span></td>
                            <td>
                                <button class="btn-resolver" title="Resolver">
                                    <i class="fa-solid fa-check"></i>
                                </button>
                                <button class="btn-detalles" title="Detalles">
                                    <i class="fa-solid fa-eye"></i>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <span class="tipo-alerta tipo-seguridad">
                                    <i class="fa-solid fa-shield-halved"></i>
                                    Evento de Seguridad
                                </span>
                            </td>
                            <td><span class="prioridad-alerta prioridad-alta">Alta</span></td>
                            <td>
                                <strong>Intento de Acceso No Autorizado</strong>
                                <br><small>Múltiples intentos fallidos en dispositivo BIO-045</small>
                            </td>
                            <td>BIO-045</td>
                            <td>15/03/2024 10:20</td>
                            <td><span class="estado-alerta activa">Activa</span></td>
                            <td>
                                <button class="btn-resolver" title="Resolver">
                                    <i class="fa-solid fa-check"></i>
                                </button>
                                <button class="btn-detalles" title="Detalles">
                                    <i class="fa-solid fa-eye"></i>
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Información de Soporte en la parte inferior -->
        <div class="soporte-info">
            <i class="fa-solid fa-headset"></i>
            <strong>¿Necesita ayuda?</strong><br>
            Contacte con Soporte Técnico al <strong>4666-1212</strong> o al correo 
            <a href="mailto:soporte@biometrika.com">soporte@biometrika.com</a>
        </div>
        <!-- Footer con el mismo diseño del login -->
        <div class="footer">
            <div>Copyright© Sistema Biométrico 2025</div>
            <div>Versión 1.0</div>
        </div>
    </main>

    <!-- Menu de usuario -->
    <nav class="menu">
        <h3><a><i class="fa-solid fa-bars"></i></a></h3>
        <div>
            <ul>
                <li><a href="{% url 'sistema:notificaciones' %}"><i class="fa-solid fa-bell"></i><b>  Notificaciones</b></a></li>
                <li><a href="{% url 'sistema:perfil' %}"><i class="fa-solid fa-user"></i><b>  Perfil</b></a></li>
                <li><a href="{% url 'sistema:cambiar_contrasena' %}"><i class="fa-solid fa-key"></i><b> contraseña</b></a></li>
                <li><a href="{% url 'sistema:configuracion' %}"><i class="fa-solid fa-cog"></i><b>  Configuración</b></a></li>
                <li><a href="{% url 'sistema:cerrar_sesion' %}"><i class="fa-solid fa-right-from-bracket"></i><b>  Cerrar Sesión</b></a></li>
            </ul>
        </div>
    </nav>

    <script src="{% static 'js/alertas.js' %}"></script>
</body>
</html>