{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Reportes - Sistema Biometrika</title>
    <link rel="stylesheet" href="{% static 'css/style_dashboard.css' %}">
    <link rel="stylesheet" href="{% static 'css/style_reporte.css' %}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!--Barra de opciones-->
    <nav class="barra_opciones"> 
        <h2>
            <div class="fingerprint-scanner" id="fingerprintScanner">
                <i class="fas fa-fingerprint fa-1x text-primary">   Biometrika</i>
            </div> 
        </h2>
        <ul>
            <li><a href="{% url 'sistema:dashboard' %}"><i class="fa-solid fa-gauge"></i>Dashboard</a></li>
            <li><a href="{% url 'sistema:sedes' %}"><i class="fa-solid fa-building"></i>Sedes y Areas</a></li>
            <li><a href="{% url 'sistema:personal' %}"><i class="fa-solid fa-users"></i>Gestion de Personal</a></li>
            <li><a href="{% url 'sistema:dispositivos' %}"><i class="fas fa-microchip"></i>Dispositivos</a></li>
            <li><a href="{% url 'sistema:soporte' %}"><i class="fa-solid fa-headset"></i> Soporte</a></li>
            <li><a href="{% url 'sistema:reportes' %}" class="active"><i class="fa-solid fa-file-lines"></i>Reportes</a></li>
            <li><a href="{% url 'sistema:alertas' %}"><i class="fa-solid fa-bell"></i>Alertas</a></li>
        </ul>
    </nav>
    
    <!--Contenido principal de la pagina-->
    <main class="contenido">
        <header>
            <h1><i class="fa-solid fa-chart-bar"></i> <b>Reportes - Sistema Biometrika</b></h1>
            <p class="subtitulo">Período: {{ fecha_inicio|date:"d/m/Y" }} - {{ fecha_fin|date:"d/m/Y" }}</p>
        </header>
        
        <!-- Resumen de reportes -->
        <section class="resumen-reportes">
            <div class="resumen-item total">
                <div class="resumen-valor">{{ total_registros }}</div>
                <div class="resumen-label">Registros Totales</div>
            </div>
            <div class="resumen-item exitosos">
                <div class="resumen-valor">{{ exitosos }}</div>
                <div class="resumen-label">Autenticaciones Exitosas</div>
            </div>
            <div class="resumen-item fallidos">
                <div class="resumen-valor">{{ fallidos }}</div>
                <div class="resumen-label">Autenticaciones Fallidas</div>
            </div>
        </section>
        
        <!-- Filtros -->
        <section class="filtros-reportes">
            <h3><i class="fa-solid fa-filter"></i> Filtros de Búsqueda</h3>
            <div class="filtros-grid">
                <div class="filtro-group">
                    <label for="filtro-fecha-inicio">Fecha Inicio</label>
                    <input type="date" id="filtro-fecha-inicio" value="{{ fecha_inicio|date:'Y-m-d' }}">
                </div>
                <div class="filtro-group">
                    <label for="filtro-fecha-fin">Fecha Fin</label>
                    <input type="date" id="filtro-fecha-fin" value="{{ fecha_fin|date:'Y-m-d' }}">
                </div>
                <div class="filtro-group">
                    <label for="filtro-estado">Estado</label>
                    <select id="filtro-estado">
                        <option value="">Todos los estados</option>
                        <option value="exitoso">Exitoso</option>
                        <option value="fallido">Fallido</option>
                        <option value="pendiente">Pendiente</option>
                    </select>
                </div>
            </div>
            <div class="botones-filtro">
                <button class="btn-filtro btn-limpiar" id="btnLimpiar">
                    <i class="fa-solid fa-eraser"></i> Limpiar Filtros
                </button>
                <button class="btn-filtro btn-aplicar" id="btnAplicar">
                    <i class="fa-solid fa-filter"></i> Aplicar Filtros
                </button>
                <button class="btn-filtro btn-exportar" id="btnExportar">
                    <i class="fa-solid fa-file-export"></i> Exportar Reporte
                </button>
            </div>
        </section>
        
        <!-- Tabla de reportes -->
        <section class="tabla-reportes">
            <h2><i class="fa-solid fa-list"></i> Registros Biométricos</h2>
            <div class="desplazamiento">
                <table id="tablaReportes">
                    <thead>
                        <tr>
                            <th>Empleado</th>
                            <th>Dispositivo</th>
                            <th>Fecha/Hora</th>
                            <th>Tipo Acceso</th>
                            <th>Estado</th>
                            <th>Credencial</th>
                        </tr>
                    </thead>    
                    <tbody id="tbodyReportes">
                        {% for registro in registros %}
                        <tr>
                            <td>
                                <strong>{{ registro.empleado.nombre_completo }}</strong>
                                <br><small>{{ registro.empleado.id_empleado }}</small>
                            </td>
                            <td>{{ registro.dispositivo.nombre }}</td>
                            <td>{{ registro.fecha_hora|date:"d/m/Y H:i:s" }}</td>
                            <td>
                                <span class="tipo-acceso tipo-{{ registro.tipo_acceso }}">
                                    {{ registro.get_tipo_acceso_display }}
                                </span>
                            </td>
                            <td>
                                <span class="estado-registro estado-{{ registro.estado }}">
                                    {{ registro.get_estado_display }}
                                </span>
                            </td>
                            <td>{{ registro.credencial.get_tipo_credencial_display }}</td>
                        </tr>
                        {% empty %}
                        <!-- Datos fijos de ejemplo -->
                        <tr>
                            <td>
                                <strong>Juan Pérez</strong>
                                <br><small>EMP-001</small>
                            </td>
                            <td>BIO-001 - Recepción</td>
                            <td>15/03/2024 08:15:23</td>
                            <td><span class="tipo-acceso tipo-entrada">Entrada</span></td>
                            <td><span class="estado-registro estado-exitoso">Exitoso</span></td>
                            <td>Huella Dactilar</td>
                        </tr>
                        <tr>
                            <td>
                                <strong>María García</strong>
                                <br><small>EMP-002</small>
                            </td>
                            <td>BIO-002 - Oficinas</td>
                            <td>15/03/2024 08:30:45</td>
                            <td><span class="tipo-acceso tipo-entrada">Entrada</span></td>
                            <td><span class="estado-registro estado-exitoso">Exitoso</span></td>
                            <td>Tarjeta de Acceso</td>
                        </tr>
                        <tr>
                            <td>
                                <strong>Carlos López</strong>
                                <br><small>EMP-003</small>
                            </td>
                            <td>BIO-003 - Almacén</td>
                            <td>15/03/2024 17:15:30</td>
                            <td><span class="tipo-acceso tipo-salida">Salida</span></td>
                            <td><span class="estado-registro estado-fallido">Fallido</span></td>
                            <td>Huella Dactilar</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <!-- Paginación -->
            <div class="paginacion">
                <div class="paginacion-info" id="infoPaginacion">
                    Mostrando {{ registros|length }} de {{ total_registros }} registros
                </div>
            </div>
        </section>

        <!-- Información de Soporte -->
        <div class="soporte-info">
            <i class="fa-solid fa-headset"></i>
            <div class="soporte-content">
                <strong>¿Necesita ayuda?</strong><br>
                Contacte con Soporte Técnico al <strong>4666-1212</strong> o al correo 
                <a href="mailto:soporte@biometrika.com">soporte@biometrika.com</a>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <div>Copyright© Sistema Biométrico 2025</div>
            <div>Versión 1.0</div>
        </div>
    </main>

    <!-- Menu de usuario -->
    <nav class="menu">
        <h3><a><i class="fa-solid fa-bars"></i></a></h3>
        <div>
            <ul>
                <li><a href="{% url 'sistema:notificaciones' %}"><i class="fa-solid fa-bell"></i><b>  Notificaciones</b></a></li>
                <li><a href="{% url 'sistema:perfil' %}"><i class="fa-solid fa-user"></i><b>  Perfil</b></a></li>
                <li><a href="{% url 'sistema:cambiar_contrasena' %}"><i class="fa-solid fa-key"></i><b> contraseña</b></a></li>
                <li><a href="{% url 'sistema:configuracion' %}"><i class="fa-solid fa-cog"></i><b>  Configuración</b></a></li>
                <li><a href="{% url 'sistema:cerrar_sesion' %}"><i class="fa-solid fa-right-from-bracket"></i><b>  Cerrar Sesión</b></a></li>
            </ul>
        </div>
    </nav>

    <!-- Modal de Exportación -->
    <div id="modalExportar" class="modal">
        <!-- Contenido del modal se mantiene igual -->
    </div>

    <script src="{% static 'js/reporte.js' %}"></script>
</body>
</html>